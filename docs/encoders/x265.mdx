---
title: x265
sidebar_position: 2
---

# x265

x265 is a software library and command line application for encoding [H.265 / HEVC](../video/HEVC.mdx) developed by MulticoreWare, written in C++ and x86 assembly, and released in 2013.

By default, x265 is tuned for low-bitrate content due to the blurring filters it applies. However, it can be tuned using CLI options to be very effective for high-fidelity content as well.
It is a more efficient and modern encoder compared to x264, and is currently a popular choice for both high-fidelity and mini encodes.

x265 is currently not recommended for lossless encoding. For that niche, x264 is considerably faster without meaningful efficiency loss.

## FFmpeg

x265 is available in FFmpeg via `libx265`, to check if you have it, run `ffmpeg -h encoder=libx265`.

## Installation

**Pre-built binary (Recommended):**

- http://msystem.waw.pl/x265/

## Parameters

This section will overview the most important parameters for controlling output and quality in x265. The parameters will be listed in the format used by the standalone x265 binary,
but all of the parameters should also be usable in ffmpeg in the format e.g. `-x265-params pass=1`.

### Preset

`--preset slow`

If encoding speed is a priority, x265 is probably not the best choice. x264 at `--preset veryslow` will likely be faster than x265 at `--preset fast`, while providing comparable efficiency.
However, x265 finds its sweet spot at `--preset slow`, and this is the preset most people should use. This preset provides high quality while not being unreasonably slow.

The exception where you may want to tax your CPU by going to `--preset veryslow` is when doing lower bitrate encodes (e.g. crf >=22). This is because the `veryslow` preset provides
better motion estimation at low bitrates. However, it is exceptionally slow, so it is not generally recommended for everyday use.

### CRF

`--crf`

CRF, standing for Constant Rate Factor, is a method for selecting a level of quality-to-filesize tradeoff. CRF is preferable to bitrate targeting because CRF only requires one encoding pass,
so bitrate targeting should only be used if you need to target a specific filesize. Nowadays, those situations are uncommon and it is preferred to use CRF to target a quality level.
CRF is preferable to QP because CRF allows the encoder to vary the quality level from frame to frame for better viewing quality in areas of the video that need it the most.

What CRF to use will vary depending on your goals. The range of valid CRF values is 0-51, with larger values providing smaller filesize but lower quality. Some amount of experimentation
may be needed to find the value you prefer. A decent "balanced" target will be around 17 or 18, providing good quality without inflating filesize too much. For a focus on maximum quality,
a value of 12 or 13 will result in visually lossless output for most videos, but will result in a much larger filesize. For miniature encodes, try raising the CRF as much as you feel comfortable
before the quality becomes unbearable. CRFs of 22 or higher are generally considered "low bitrate", so how high you raise the CRF depends on how low of a filesize you are trying to achieve.

### bframes

`--bframes`

B-frames are bi-directional predictive frames, this means that they can reference frames both before and after themselves, which makes them very efficient.
The `--bframes` parameter controls how many B-frames can be used consecutively. Higher values can result in better compression, but this value has diminishing returns,
as the encoder won't use extra B-frames in situations where it would reduce efficiency.

The default value at preset slow is `4`. It is recommended to increase this to `--bframes 5` for live action and CGI content, or `--bframes 8` for anime and cartoons.
Content with little motion benefits more from high B-frames values, but even on anime where there are many still scenes, there is no measurable benefit
to using a value higher than `8`, and it would just slow down the encoder for no benefit.

### SAO

`--sao`, `--limit-sao`, `--no-sao`

SAO or Sample Adaptive Offset is a restoration filter in h.265 used to prevent obvious blocking and ringing artifacts especially around sharp edges.
However this does sometimes come at the cost of some finer details in the video like for example human skin and surface details.
Generally speaking at crf values at or above 20 you can leave this option on which is default as it does a good job of making the overall video more appealing.

x265 however has a primitive implementation of SAO which tends to be too aggressive at high quality or fidelity ranges leading to blurring around crf 19-16.
while it does "limit" how much the encoder uses SAO, `--limit-sao` is more of an early termination for the encoder deciding where to use it rather than limiting its strength.
However it does generally do a good job of preserving more detail than normal even if it makes some artifacts more noticeable.

For below crf 16 depending on your content it might be preferable to outright disable sao with `--no-sao` as usually at such high quality its not usually needed.

### Deblock

`--deblock`

Deblock is another loop filter, this one intended to reduce blocking in videos, but may have a blurring effect at high strengths. For most encodes, it is fine to leave this
at the default value. At lower CRF values, it may be desirable to lower this to `--deblock -1:-1` for anime or `--deblock -2:-2` for live action, in order to preserve
more grain and detail.

### Psy-RD

`--psy-rd` and `--psy-rdoq`

To make a long story short `--psy-rd` and `--psy-rdoq` together are psychovisual optimization tools used to control the encoders willingness to retain finer detail and noise in the
final encode. However the way the two settings achieve this are very different.

`--psy-rd` retains detail by affecting the how the encoder weights sections of the frame based off the amount of "energy" or high frequency information it contains and boosts them
accordingly.

`--psy-rdoq` retains detail by affecting how the encoder quantizes coefficients after transformations. It has no reference to the source in its calculation and only prefers
retaining overall detail and nothing specific.

Both settings are highly source dependent and ideally would be tweaked per scene in a video. Unless you know what you're doing and are willing to test thoroughly that the settings you
are using are beneficial its almost always recommended to never touch either setting as the defaults for both are good general purpose settings.
However as a general rule of thumb `--psy-rd` is better at retaining specific detail and overall sharpness while `--psy-rdoq` is better at retaining overall noise.

You can read more about the importance of perceptual optimization in video encoders on the [psychovisual](../introduction/psychovisual.mdx) page.

### Adaptive Quantization

`--aq-mode` and `--aq-strength`

Adaptive quantization (`--aq-mode`), shortened to AQ, is a mechanism to redistribute bitrate within a frame to improve perceptual quality consistency.
In x265 we have 4 modes.
 1. AQ enabled
 2. AQ with auto variance (default)
 3. AQ 2 with a bias for dark scenes
 4. AQ 2 with edge information 

Generally speaking we always want AQ 2 or AQ with auto variance as this will bias both parts of the frame that are smooth and textured. Normally these parts of the frame are bitrate starved
and have the most noticeable artifacting.

Some people will use AQ 3 to as the name implies preserve detail in dark scenes and parts of the frame. However in metric analysis and some visual, AQ 3 sometimes bloats bitrates for minor to
no gains. When playing back on newer displays like high contrast VA TVs or oleds dark parts tend to also be much dark making it harder to see artifacts and blurring otherwise more noticeable on
older technologies like ips with backlight glow. While this is not an entirely useless AQ mode, thorough testing should be done before using it.

The relative strength of an AQ mode can also be controlled with `--aq-strength`. While the default is `1.0`, many people do lower it to `0.7` or `0.8` for flat anime or compressed irl content.
In general like other psychovisual optimization tools in x265, these settings are highly source dependant and are best left at their defaults unless you know what you are doing and have data
to back it up.

### CU-Tree

`--no-cutree`

CU-Tree is a mechanism very similar to MB-Tree in x264, which is intended to redistribute bitrate in a more optimal psychovisual manner. However, many people find CU-Tree to be harmful to quality,
especially when attempting to encode videos with considerable amounts of grain, and therefore many people recommend disabling this with `--no-cutree`.
